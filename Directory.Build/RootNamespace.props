<Project InitialTargets="DisplayRootNamespace">
  <PropertyGroup>
    <_GitRoot>$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildProjectDirectory), ".git/HEAD"))</_GitRoot>
    <_RelativePath>$([MSBuild]::MakeRelative($(_GitRoot), $(MSBuildProjectDirectory)))</_RelativePath>

    <_RelativeNamespace>$([System.IO.Path]::GetFileName($(_GitRoot))).$(_RelativePath.Replace("\", ".").Replace("/", ".").Replace("src.", "").Replace("tests.", "").Replace($(MSBuildProjectExtension), ""))</_RelativeNamespace>

    <!-- Remove duplicates, e.g., Microsoft.Microsoft becomes Microsoft. -->
    <_FixedRelativeNamespace>$([System.Text.RegularExpressions.Regex]::Replace($(_RelativeNamespace), "(\w+)\.\1\.", "$1."))</_FixedRelativeNamespace>
    <_FixedRelativeNamespace>$([System.Text.RegularExpressions.Regex]::Replace($(_FixedRelativeNamespace), "^\.+", ""))</_FixedRelativeNamespace>
    <RootNamespace Condition="'$(UseJustinWritesCodeNamespace)' != 'false' And !$(RootNamespace.StartsWith('JustinWritesCode'))">JustinWritesCode.$(_FixedRelativeNamespace)</RootNamespace>
    <RootNamespace Condition="'$(UseJustinWritesCodeNamespace)' == 'false'">$(_FixedRelativeNamespace)</RootNamespace>
    <PackageId Condition="!$(PackageId.StartsWith('JustinWritesCode'))">$(RootNamespace)</PackageId>
    <RootNamespace>$([System.Text.RegularExpressions.Regex]::Replace($(RootNamespace), "\-", ""))</RootNamespace>
    <!-- <PackageId Condition="'$(UseJustinWritesCodeNamespace)' != 'false'">JustinWritesCode.@(RelativeNamespacePiecesNoDups->'%(Identity)', '.')</PackageId>
    <PackageId Condition="'$(UseJustinWritesCodeNamespace)' == 'false'">@(RelativeNamespacePiecesNoDups->'%(Identity)', '.')</PackageId> -->
  </PropertyGroup>
  <Target Name="DisplayRootNamespace">
    <Message Importance="High" Text="MSBuildProjectFile: $(MSBuildProjectFullPath)" />
    <Message Importance="High" Text="_RelativeNamespace: $(_RelativeNamespace)" />
    <Message Importance="High" Text="_FixedRelativeNamespace: $(_FixedRelativeNamespace)" />
    <Message Importance="High" Text="RootNamespace: $(RootNamespace)" />
    <Message Importance="High" Text="PackageId: $(PackageId)" />
  </Target>
</Project>
